<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BarCrawler</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <!-- AIzaSyCBPWM21XoXtodJFdDLALgxieohvqyIH7E -->
    <style>
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        #map-container {
            flex: 1 1 auto;
            background-color: #CCC;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand navbar-dark bg-dark">
      <a class="navbar-brand" href="#">BarCrawler</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample02" aria-controls="navbarsExample02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="#">Sign In <span class="sr-only">(current)</span></a>
          </li>
        </ul>
        <form class="form-inline my-2 my-md-0" id="google-form">
          <input class="form-control mr-sm-2" type="search" placeholder="3650 McClintock Avenue, Los Angeles, CA 90089" aria-label="Search" id="address">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </nav>

    <div class="container-fluid">
      <div class="row">
        <div class="col-md-9" id="map-container" style="height: 92vh;">col-8</div>
        <div class="col-md-3" id="searchResults" style="padding-left: 0; padding-right: 0; text-align: center;">
          <div style="background-color: red; color: black">
            <h3>Results</h3>
          </div>


        </div>
      </div>
    </div> <!-- #map-container -->

    <script>

        function initMap() {
            console.log("I'm Working");
            var map = new google.maps.Map(
                document.querySelector("#map-container"),
                {center: {lat: 34.05,lng: -118.24}, zoom : 15, zoomControl: true}
            );
            var marker = new google.maps.Marker(
                {map: map}
            );

            // map from user input
            document.querySelector("#google-form").onsubmit = function() {
                var input = document.querySelector("#address").value.trim();
                infowindow = new google.maps.InfoWindow();
                // turn address to lat and long
                var geocodeObj = new google.maps.Geocoder();
                var service = new google.maps.places.PlacesService(map);
                geocodeObj.geocode(
                    {address: input},
                    function(results) {
                      // move the map to the search location
                      map.setCenter(results[0].geometry.location);
                      marker.setPosition(results[0].geometry.location);
                      var latLng = results[0].geometry.location;
                      var request = {
                        location: latLng,
                        radius: '1000',
                        type: ['bar']
                      };
                      service.nearbySearch(request, callback);
                    }
                );
                return false;
            }
          function callback(results, status) {
            if (status == google.maps.places.PlacesServiceStatus.OK) {
              console.log(results);
              for (var i = 0; i < results.length; i++) {
                var place = results[i];
                createMarker(results[i]);
              }
            }
          }
          function createMarker(place) {
            console.log(place.photos[0].getUrl);
            addRow(place);
            //console.log(place.photos[0].getUrl({'maxWidth': 35, 'maxHeight': 35}));
            var placeLoc = place.geometry.location;
            var imageIcon = {
              url: "http://www.iconarchive.com/download/i97927/flat-icons.com/flat/Beer.ico",
              size: new google.maps.Size(30, 30),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(0, 0),
              scaledSize: new google.maps.Size(30, 30)
            };
            var marker = new google.maps.Marker({
              map: map,
              position: place.geometry.location,
              icon: imageIcon
            });
            google.maps.event.addListener(marker, 'click', function() {
              infowindow.setContent(place.name);
              infowindow.open(map, this);
            });
          }
          function addRow(place) {
            var div = document.createElement('div');
            var text = document.createElement('h5');
            var node = document.createTextNode(place.name);
            text.appendChild(node);
            var img = document.createElement("img");
            img.src = place.photos[0].getUrl({'maxWidth': 200, 'maxHeight': 200});
            div.appendChild(text);
            div.appendChild(img);
            document.getElementById('searchResults').appendChild(div);
          }
        }

    </script>
     <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCBPWM21XoXtodJFdDLALgxieohvqyIH7E&libraries=places&callback=initMap"></script>
</body>
</html>
